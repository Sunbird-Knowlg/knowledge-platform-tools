import { Component, Inject } from '@angular/core';
import { MAT_DIALOG_DATA } from '@angular/material/dialog';
import { startWith, map } from 'rxjs/operators';
import { Validators } from '@angular/forms';
import * as appConstants from '../../constants/app-constant';
import { labels } from '../../labels/strings';
import * as i0 from "@angular/core";
import * as i1 from "@angular/material/dialog";
import * as i2 from "../../services/framework.service";
import * as i3 from "@angular/forms";
import * as i4 from "@angular/common";
import * as i5 from "@angular/material/form-field";
import * as i6 from "@angular/material/button";
import * as i7 from "@angular/material/input";
import * as i8 from "@angular/material/autocomplete";
import * as i9 from "@angular/material/core";
export class CreateTermComponent {
    constructor(dialogRef, data, frameWorkService, fb) {
        this.dialogRef = dialogRef;
        this.data = data;
        this.frameWorkService = frameWorkService;
        this.fb = fb;
        this.name = '';
        this.termLists = [];
        this.disableCreate = false;
        this.isTermExist = false;
        this.selectedTerm = {};
        this.app_strings = labels;
    }
    ngOnInit() {
        this.termLists = this.data.columnInfo.children;
        this.initTermForm();
    }
    initTermForm() {
        this.createTermForm = this.fb.group({
            name: ['', [Validators.required]],
            description: [''],
            area: [''],
            type: ['']
        });
        this.filtedTermLists = this.createTermForm.get('name').valueChanges.pipe(startWith(''), map(value => this._filter(value || '')));
    }
    _filter(searchTxt) {
        let isExist;
        this.disableCreate = false;
        this.isTermExist = false;
        this.createTermForm.get('description').enable();
        this.createTermForm.get('area').enable();
        this.createTermForm.get('type').enable();
        // this.createTermForm.get('description').patchValue('')
        const filterValue = typeof (searchTxt) === 'object' ? this._normalizeValue(searchTxt.name) : this._normalizeValue(searchTxt);
        isExist = this.termLists.filter(term => this._normalizeValue(term.name).includes(filterValue));
        return isExist;
    }
    _normalizeValue(value) {
        return value.toLowerCase().replace(/\s/g, '');
    }
    onSelect(term) {
        this.selectedTerm = term.value;
        this.createTermForm.get('name').patchValue(term.value.name);
        this.createTermForm.get('description').patchValue(term.value.description);
        this.createTermForm.get('description').disable();
        this.createTermForm.get('area').patchValue(term.value.area);
        this.createTermForm.get('area').disable();
        this.createTermForm.get('type').patchValue(term.value.type);
        this.createTermForm.get('type').disable();
        this.disableCreate = true;
    }
    saveTerm() {
        if (this._filter(this.createTermForm.value.name).length > 0) {
            this.isTermExist = true;
            console.log('Already exist');
            return;
        }
        if (this.createTermForm.valid) {
            const term = {
                code: this.frameWorkService.getUuid(),
                name: this.createTermForm.value.name,
                description: this.createTermForm.value.description,
                status: appConstants.LIVE,
                approvalStatus: appConstants.DRAFT,
                parents: [
                    { identifier: `${this.data.columnInfo.identifier}` }
                ],
                additionalProperties: {}
            };
            const requestBody = {
                request: {
                    term: term
                }
            };
            this.frameWorkService.createTerm(this.data.frameworkId, this.data.columnInfo.code, requestBody).subscribe((res) => {
                requestBody.request.term['identifier'] = res.result.node_id[0];
                this.dialogClose({ term: requestBody.request.term, created: true });
                this.selectedTerm = requestBody.request.term;
                this.updateTerm();
            });
        }
    }
    updateTerm() {
        let associations = [];
        let temp;
        let counter = 0;
        let localIsExist = false;
        this.frameWorkService.selectionList.forEach((parent, i) => {
            counter++;
            temp = parent.children ? parent.children.filter(child => child.identifier === this.selectedTerm.identifier) : null;
            associations = parent.children ? parent.children.map(c => {
                return { identifier: c.identifier }; // approvalStatus: c.associationProperties?c.associationProperties.approvalStatus: 'Draft'
            }) : [];
            if (temp && temp.length) {
                this.isTermExist = true;
                return;
            }
            else {
                associations.push({ identifier: this.selectedTerm.identifier }); // approvalStatus: appConstants.DRAFT 
                this.isTermExist = false;
                const reguestBody = {
                    request: {
                        term: {
                            associations: [
                                ...associations
                            ]
                        }
                    }
                };
                // console.log('***************************',associations)
                // this.dialogClose({ term: this.selectedTerm, created: true })
                this.frameWorkService.updateTerm(this.data.frameworkId, parent.category, parent.code, reguestBody).subscribe((res) => {
                    counter--;
                    if (counter === 0) {
                        // this.selectedTerm['associationProperties']['approvalStatus'] = 'Draft';
                        this.dialogClose({ term: { ...this.selectedTerm, ...{ associationProperties: { approvalStatus: 'Draft' } } }, created: true });
                    }
                });
            }
        });
    }
    dialogClose(term) {
        this.frameWorkService.publishFramework().subscribe(res => {
            this.dialogRef.close(term);
        });
    }
}
CreateTermComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: CreateTermComponent, deps: [{ token: i1.MatDialogRef }, { token: MAT_DIALOG_DATA }, { token: i2.FrameworkService }, { token: i3.FormBuilder }], target: i0.ɵɵFactoryTarget.Component });
CreateTermComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.3.0", type: CreateTermComponent, selector: "lib-create-term", ngImport: i0, template: "<div class=\"dialog\">\n    <div class=\"dialog-title\" mat-dialog-title>{{app_strings.createNew}} {{data.columnInfo.name}}</div>\n    <form [formGroup]=\"createTermForm\" novalidate (ngSubmit)=\"disableCreate?updateTerm():saveTerm()\">\n        <mat-form-field>\n            <!-- <mat-label>Enter {{data.name}} name</mat-label> -->\n            <input matInput formControlName=\"name\" placeholder=\"{{app_strings.name}}\"   [matAutocomplete]=\"auto\">\n            <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onSelect($event.option)\">\n                <mat-option *ngFor=\"let option of filtedTermLists | async\"  [value]=\"option\">\n                  {{option.name}}\n                </mat-option>\n              </mat-autocomplete>\n        </mat-form-field>\n        <mat-error *ngIf=\"isTermExist\">{{app_strings.alreadyExist}}</mat-error>\n        <mat-form-field>\n            <!-- <mat-label>Enter {{data.name}} name</mat-label> -->\n            <textarea matInput formControlName=\"description\" placeholder=\"{{app_strings.description}}\"></textarea>\n        </mat-form-field>\n        <mat-form-field>\n            <!-- <mat-label>Enter {{data.area}} area</mat-label> -->\n            <input matInput formControlName=\"name\" placeholder=\"{{app_strings.area}}\"   [matAutocomplete]=\"auto\">\n        </mat-form-field>\n        <mat-form-field>\n            <!-- <mat-label>Enter {{data.type}} type</mat-label> -->\n            <input matInput formControlName=\"name\" placeholder=\"{{app_strings.name}}\"   [matAutocomplete]=\"auto\">\n        </mat-form-field>\n         <footer class=\"actions\">\n            <button mat-raised-button color=\"default\" type=\"reset\" (click)=\"dialogClose('')\">{{app_strings.cancel}}</button>\n            <button mat-raised-button color=\"primary\" type=\"submit\" cdkFocusInitial *ngIf=\"!disableCreate\">{{app_strings.create}}</button>\n            <button mat-raised-button color=\"primary\" type=\"submit\" cdkFocusInitial *ngIf=\"disableCreate\">{{app_strings.update}}</button>\n        </footer>\n    </form>\n</div>\n", styles: [".dialog .mat-dialog-title{padding:1em;margin-bottom:0;background:#EEEEEE}.dialog .mat-form-field{width:90%;padding:0;background:#FFFFFF;margin:1em;border-radius:2px}.dialog .mat-form-field-outline{color:#fff}.dialog .mat-form-field ::ng-deep .mat-form-field-wrapper{padding-bottom:0}.dialog .mat-form-field ::ng-deep .mat-form-field-wrapper .mat-form-field-infix{padding:15px;margin-top:0;border-top:0}.dialog .mat-form-field ::ng-deep .mat-form-field-wrapper .mat-form-field-infix textarea{resize:none}.dialog .mat-form-field-disabled{background:#EEEEEE}.dialog .actions{display:flex;flex-direction:row;justify-content:space-between;padding:0 1em 1em}.dialog .mat-error{padding:0 25px;margin-top:-10px}.dialog-title{align-items:center;display:flex}::ng-deep .custom-dialog-container .mat-dialog-container{width:500px;padding:0;border-radius:0;background:#EEEEEE}@media only screen and (max-width: 1024px){::ng-deep .cdk-overlay-pane{width:40%!important}}@media only screen and (max-width: 992px){::ng-deep .cdk-overlay-pane{width:45%!important}}@media only screen and (max-width: 1024px){.dialog{font-size:12px}.dialog .dialog-title{font-size:24px;height:1em}.dialog button{font-size:12px;line-height:3.5em}.dialog .mat-raised-button{padding:0 3em}}\n"], dependencies: [{ kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i3.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i3.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i3.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "directive", type: i5.MatError, selector: "mat-error", inputs: ["id"] }, { kind: "component", type: i5.MatFormField, selector: "mat-form-field", inputs: ["color", "appearance", "hideRequiredMarker", "hintLabel", "floatLabel"], exportAs: ["matFormField"] }, { kind: "component", type: i6.MatButton, selector: "button[mat-button], button[mat-raised-button], button[mat-icon-button],             button[mat-fab], button[mat-mini-fab], button[mat-stroked-button],             button[mat-flat-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { kind: "directive", type: i7.MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["disabled", "id", "placeholder", "name", "required", "type", "errorStateMatcher", "aria-describedby", "value", "readonly"], exportAs: ["matInput"] }, { kind: "directive", type: i1.MatDialogTitle, selector: "[mat-dialog-title], [matDialogTitle]", inputs: ["id"], exportAs: ["matDialogTitle"] }, { kind: "component", type: i8.MatAutocomplete, selector: "mat-autocomplete", inputs: ["disableRipple"], exportAs: ["matAutocomplete"] }, { kind: "directive", type: i8.MatAutocompleteTrigger, selector: "input[matAutocomplete], textarea[matAutocomplete]", exportAs: ["matAutocompleteTrigger"] }, { kind: "component", type: i9.MatOption, selector: "mat-option", exportAs: ["matOption"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: CreateTermComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-create-term', template: "<div class=\"dialog\">\n    <div class=\"dialog-title\" mat-dialog-title>{{app_strings.createNew}} {{data.columnInfo.name}}</div>\n    <form [formGroup]=\"createTermForm\" novalidate (ngSubmit)=\"disableCreate?updateTerm():saveTerm()\">\n        <mat-form-field>\n            <!-- <mat-label>Enter {{data.name}} name</mat-label> -->\n            <input matInput formControlName=\"name\" placeholder=\"{{app_strings.name}}\"   [matAutocomplete]=\"auto\">\n            <mat-autocomplete #auto=\"matAutocomplete\" (optionSelected)=\"onSelect($event.option)\">\n                <mat-option *ngFor=\"let option of filtedTermLists | async\"  [value]=\"option\">\n                  {{option.name}}\n                </mat-option>\n              </mat-autocomplete>\n        </mat-form-field>\n        <mat-error *ngIf=\"isTermExist\">{{app_strings.alreadyExist}}</mat-error>\n        <mat-form-field>\n            <!-- <mat-label>Enter {{data.name}} name</mat-label> -->\n            <textarea matInput formControlName=\"description\" placeholder=\"{{app_strings.description}}\"></textarea>\n        </mat-form-field>\n        <mat-form-field>\n            <!-- <mat-label>Enter {{data.area}} area</mat-label> -->\n            <input matInput formControlName=\"name\" placeholder=\"{{app_strings.area}}\"   [matAutocomplete]=\"auto\">\n        </mat-form-field>\n        <mat-form-field>\n            <!-- <mat-label>Enter {{data.type}} type</mat-label> -->\n            <input matInput formControlName=\"name\" placeholder=\"{{app_strings.name}}\"   [matAutocomplete]=\"auto\">\n        </mat-form-field>\n         <footer class=\"actions\">\n            <button mat-raised-button color=\"default\" type=\"reset\" (click)=\"dialogClose('')\">{{app_strings.cancel}}</button>\n            <button mat-raised-button color=\"primary\" type=\"submit\" cdkFocusInitial *ngIf=\"!disableCreate\">{{app_strings.create}}</button>\n            <button mat-raised-button color=\"primary\" type=\"submit\" cdkFocusInitial *ngIf=\"disableCreate\">{{app_strings.update}}</button>\n        </footer>\n    </form>\n</div>\n", styles: [".dialog .mat-dialog-title{padding:1em;margin-bottom:0;background:#EEEEEE}.dialog .mat-form-field{width:90%;padding:0;background:#FFFFFF;margin:1em;border-radius:2px}.dialog .mat-form-field-outline{color:#fff}.dialog .mat-form-field ::ng-deep .mat-form-field-wrapper{padding-bottom:0}.dialog .mat-form-field ::ng-deep .mat-form-field-wrapper .mat-form-field-infix{padding:15px;margin-top:0;border-top:0}.dialog .mat-form-field ::ng-deep .mat-form-field-wrapper .mat-form-field-infix textarea{resize:none}.dialog .mat-form-field-disabled{background:#EEEEEE}.dialog .actions{display:flex;flex-direction:row;justify-content:space-between;padding:0 1em 1em}.dialog .mat-error{padding:0 25px;margin-top:-10px}.dialog-title{align-items:center;display:flex}::ng-deep .custom-dialog-container .mat-dialog-container{width:500px;padding:0;border-radius:0;background:#EEEEEE}@media only screen and (max-width: 1024px){::ng-deep .cdk-overlay-pane{width:40%!important}}@media only screen and (max-width: 992px){::ng-deep .cdk-overlay-pane{width:45%!important}}@media only screen and (max-width: 1024px){.dialog{font-size:12px}.dialog .dialog-title{font-size:24px;height:1em}.dialog button{font-size:12px;line-height:3.5em}.dialog .mat-raised-button{padding:0 3em}}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.MatDialogRef }, { type: undefined, decorators: [{
                    type: Inject,
                    args: [MAT_DIALOG_DATA]
                }] }, { type: i2.FrameworkService }, { type: i3.FormBuilder }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLXRlcm0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc2ItdGF4b25vbXktZWRpdG9yL3NyYy9saWIvY29tcG9uZW50cy9jcmVhdGUtdGVybS9jcmVhdGUtdGVybS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zYi10YXhvbm9teS1lZGl0b3Ivc3JjL2xpYi9jb21wb25lbnRzL2NyZWF0ZS10ZXJtL2NyZWF0ZS10ZXJtLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQzFELE9BQU8sRUFBZ0IsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFFekUsT0FBTyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoRCxPQUFPLEVBQWtELFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBSTVGLE9BQU8sS0FBSyxZQUFZLE1BQU0sOEJBQThCLENBQUM7QUFDN0QsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHNCQUFzQixDQUFDOzs7Ozs7Ozs7OztBQVM5QyxNQUFNLE9BQU8sbUJBQW1CO0lBUzdCLFlBQ1EsU0FBNEMsRUFDbkIsSUFBUyxFQUNqQyxnQkFBa0MsRUFDbEMsRUFBZTtRQUhoQixjQUFTLEdBQVQsU0FBUyxDQUFtQztRQUNuQixTQUFJLEdBQUosSUFBSSxDQUFLO1FBQ2pDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDbEMsT0FBRSxHQUFGLEVBQUUsQ0FBYTtRQVp6QixTQUFJLEdBQVcsRUFBRSxDQUFDO1FBQ2xCLGNBQVMsR0FBZ0IsRUFBRSxDQUFDO1FBRzVCLGtCQUFhLEdBQVksS0FBSyxDQUFDO1FBQy9CLGdCQUFXLEdBQVksS0FBSyxDQUFDO1FBQzdCLGlCQUFZLEdBQVEs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QUFDLE9BQU8sRUFBQyxFQUFDLEVBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtxQkFDdkg7Z0JBQ0gsQ0FBQyxDQUFDLENBQUE7YUFDSDtRQUNMLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELFdBQVcsQ0FBQyxJQUFJO1FBQ1osSUFBSSxDQUFDLGdCQUFnQixDQUFDLGdCQUFnQixFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3ZELElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQzs7Z0hBNUlVLG1CQUFtQiw4Q0FXcEIsZUFBZTtvR0FYZCxtQkFBbUIsdURDbEJoQyxxakVBZ0NBOzJGRGRhLG1CQUFtQjtrQkFOL0IsU0FBUzsrQkFDRSxpQkFBaUI7OzBCQWdCeEIsTUFBTTsyQkFBQyxlQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbmplY3QsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nUmVmLCBNQVRfRElBTE9HX0RBVEEgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgRnJhbWV3b3JrU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL2ZyYW1ld29yay5zZXJ2aWNlJztcbmltcG9ydCB7IHN0YXJ0V2l0aCwgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRm9ybUFycmF5LCBGb3JtQ29udHJvbCwgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzL2ludGVybmFsL09ic2VydmFibGUnO1xuLy8gaW1wb3J0IHsgSWRlbnRpZmllcnMgfSBmcm9tICdAYW5ndWxhci9jb21waWxlcic7XG5pbXBvcnQgeyBOU0ZyYW1ld29yayB9IGZyb20gJy4uLy4uL21vZGVscy9mcmFtZXdvcmsubW9kZWwnO1xuaW1wb3J0ICogYXMgYXBwQ29uc3RhbnRzIGZyb20gJy4uLy4uL2NvbnN0YW50cy9hcHAtY29uc3RhbnQnO1xuaW1wb3J0IHsgbGFiZWxzIH0gZnJvbSAnLi4vLi4vbGFiZWxzL3N0cmluZ3MnO1xuaW1wb3J0IHsgQ2FyZENoZWNrZWQsIENhcmRTZWxlY3Rpb24sIENhcmRzQ291bnQsIENhcmQgfSBmcm9tICcuLi8uLi9tb2RlbHMvdmFyaWFibGUtdHlwZS5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2xpYi1jcmVhdGUtdGVybScsXG4gIHRlbXBsYXRlVXJsOiAnLi9jcmVhdGUtdGVybS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2NyZWF0ZS10ZXJtLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5cbmV4cG9ydCBjbGFzcyBDcmVhdGVUZXJtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgbmFtZTogc3RyaW5nID0gJyc7XG4gIHRlcm1MaXN0czogQXJyYXk8Q2FyZD4gPSBbXTtcbiAgZmlsdGVkVGVybUxpc3RzOiBPYnNlcnZhYmxlPGFueVtdPjtcbiAgY3JlYXRlVGVybUZvcm06IEZvcm1Hcm91cFxuICBkaXNhYmxlQ3JlYXRlOiBib29sZWFuID0gZmFsc2U7XG4gIGlzVGVybUV4aXN0OiBib29sZWFuID0gZmFsc2U7XG4gIHNlbGVjdGVkVGVybTpDYXJkID0ge307XG4gIGFwcF9zdHJpbmdzID0gbGFiZWxzO1xuICAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGRpYWxvZ1JlZjogTWF0RGlhbG9nUmVmPENyZWF0ZVRlcm1Db21wb25lbnQ+LFxuICAgIEBJbmplY3QoTUFUX0RJQUxPR19EQVRBKSBwdWJsaWMgZGF0YTogYW55LFxuICAgIHByaXZhdGUgZnJhbWVXb3JrU2VydmljZTogRnJhbWV3b3JrU2VydmljZSxcbiAgICBwcml2YXRlIGZiOiBGb3JtQnVpbGRlclxuICApIHsgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMudGVybUxpc3RzID0gdGhpcy5kYXRhLmNvbHVtbkluZm8uY2hpbGRyZW5cbiAgICB0aGlzLmluaXRUZXJtRm9ybSgpXG4gIH1cblxuICBpbml0VGVybUZvcm0oKSB7XG4gICAgdGhpcy5jcmVhdGVUZXJtRm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgbmFtZTogWycnLCBbVmFsaWRhdG9ycy5yZXF1aXJlZF1dLFxuICAgICAgZGVzY3JpcHRpb246IFsnJ10sXG4gICAgICBhcmVhOiBbJyddLFxuICAgICAgdHlwZTogWycnXVxuICAgIH0pXG4gICAgdGhpcy5maWx0ZWRUZXJtTGlzdHMgPSB0aGlzLmNyZWF0ZVRlcm1Gb3JtLmdldCgnbmFtZScpLnZhbHVlQ2hhbmdlcy5waXBlKFxuICAgICAgc3RhcnRXaXRoKCcnKSxcbiAgICAgIG1hcCh2YWx1ZSA9PiB0aGlzLl9maWx0ZXIodmFsdWUgfHwgJycpKSxcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBfZmlsdGVyKHNlYXJjaFR4dDogYW55KTogc3RyaW5nW10ge1xuICAgIGxldCBpc0V4aXN0O1xuICAgIHRoaXMuZGlzYWJsZUNyZWF0ZSA9IGZhbHNlXG4gICAgdGhpcy5pc1Rlcm1FeGlzdCA9IGZhbHNlXG4gICAgdGhpcy5jcmVhdGVUZXJtRm9ybS5nZXQoJ2Rlc2NyaXB0aW9uJykuZW5hYmxlKClcbiAgICB0aGlzLmNyZWF0ZVRlcm1Gb3JtLmdldCgnYXJlYScpLmVuYWJsZSgpXG4gICAgdGhpcy5jcmVhdGVUZXJtRm9ybS5nZXQoJ3R5cGUnKS5lbmFibGUoKVxuICAgIC8vIHRoaXMuY3JlYXRlVGVybUZvcm0uZ2V0KCdkZXNjcmlwdGlvbicpLnBhdGNoVmFsdWUoJycpXG4gICAgY29uc3QgZmlsdGVyVmFsdWUgPSB0eXBlb2Yoc2VhcmNoVHh0KT09PSdvYmplY3QnPyB0aGlzLl9ub3JtYWxpemVWYWx1ZShzZWFyY2hUeHQubmFtZSk6dGhpcy5fbm9ybWFsaXplVmFsdWUoc2VhcmNoVHh0KTtcbiAgICBpc0V4aXN0ID0gdGhpcy50ZXJtTGlzdHMuZmlsdGVyKHRlcm0gPT4gdGhpcy5fbm9ybWFsaXplVmFsdWUodGVybS5uYW1lKS5pbmNsdWRlcyhmaWx0ZXJWYWx1ZSkpO1xuICAgIHJldHVybiBpc0V4aXN0XG4gIH1cblxuICBwcml2YXRlIF9ub3JtYWxpemVWYWx1ZSh2YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdmFsdWUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9cXHMvZywgJycpO1xuICB9XG5cbiAgb25TZWxlY3QodGVybSkge1xuICAgIHRoaXMuc2VsZWN0ZWRUZXJtID0gdGVybS52YWx1ZVxuICAgIHRoaXMuY3JlYXRlVGVybUZvcm0uZ2V0KCduYW1lJykucGF0Y2hWYWx1ZSh0ZXJtLnZhbHVlLm5hbWUpXG4gICAgdGhpcy5jcmVhdGVUZXJtRm9ybS5nZXQoJ2Rlc2NyaXB0aW9uJykucGF0Y2hWYWx1ZSh0ZXJtLnZhbHVlLmRlc2NyaXB0aW9uKVxuICAgIHRoaXMuY3JlYXRlVGVybUZvcm0uZ2V0KCdkZXNjcmlwdGlvbicpLmRpc2FibGUoKVxuICAgIHRoaXMuY3JlYXRlVGVybUZvcm0uZ2V0KCdhcmVhJykucGF0Y2hWYWx1ZSh0ZXJtLnZhbHVlLmFyZWEpXG4gICAgdGhpcy5jcmVhdGVUZXJtRm9ybS5nZXQoJ2FyZWEnKS5kaXNhYmxlKClcbiAgICB0aGlzLmNyZWF0ZVRlcm1Gb3JtLmdldCgndHlwZScpLnBhdGNoVmFsdWUodGVybS52YWx1ZS50eXBlKVxuICAgIHRoaXMuY3JlYXRlVGVybUZvcm0uZ2V0KCd0eXBlJykuZGlzYWJsZSgpXG4gICAgdGhpcy5kaXNhYmxlQ3JlYXRlID0gdHJ1ZVxuICB9XG5cbiBzYXZlVGVybSgpIHtcbiAgICAgIGlmKHRoaXMuX2ZpbHRlcih0aGlzLmNyZWF0ZVRlcm1Gb3JtLnZhbHVlLm5hbWUpLmxlbmd0aD4wKXtcbiAgICAgICAgdGhpcy5pc1Rlcm1FeGlzdCA9IHRydWVcbiAgICAgICAgY29uc29sZS5sb2coJ0FscmVhZHkgZXhpc3QnKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuY3JlYXRlVGVybUZvcm0udmFsaWQpIHtcbiAgICAgICAgY29uc3QgdGVybTpOU0ZyYW1ld29yay5JQ3JlYXRlVGVybSA9ICAge1xuICAgICAgICAgIGNvZGU6dGhpcy5mcmFtZVdvcmtTZXJ2aWNlLmdldFV1aWQoKSxcbiAgICAgICAgICBuYW1lOnRoaXMuY3JlYXRlVGVybUZvcm0udmFsdWUubmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjp0aGlzLmNyZWF0ZVRlcm1Gb3JtLnZhbHVlLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIHN0YXR1czogYXBwQ29uc3RhbnRzLkxJVkUsXG4gICAgICAgICAgYXBwcm92YWxTdGF0dXM6YXBwQ29uc3RhbnRzLkRSQUZULFxuICAgICAgICAgIHBhcmVudHM6W1xuICAgICAgICAgICAge2lkZW50aWZpZXI6YCR7dGhpcy5kYXRhLmNvbHVtbkluZm8uaWRlbnRpZmllcn1gfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXM6e31cbiAgICAgICAgfVxuICAgICAgICBjb25zdCByZXF1ZXN0Qm9keSA9ICB7XG4gICAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgICAgdGVybTogdGVybVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXG4gICAgICB0aGlzLmZyYW1lV29ya1NlcnZpY2UuY3JlYXRlVGVybSh0aGlzLmRhdGEuZnJhbWV3b3JrSWQsIHRoaXMuZGF0YS5jb2x1bW5JbmZvLmNvZGUsIHJlcXVlc3RCb2R5KS5zdWJzY3JpYmUoKHJlczphbnkpID0+IHtcbiAgICAgICAgcmVxdWVzdEJvZHkucmVxdWVzdC50ZXJtWydpZGVudGlmaWVyJ10gPSByZXMucmVzdWx0Lm5vZGVfaWRbMF1cbiAgICAgICAgdGhpcy5kaWFsb2dDbG9zZSh7IHRlcm06IHJlcXVlc3RCb2R5LnJlcXVlc3QudGVybSwgY3JlYXRlZDogdHJ1ZSB9KVxuICAgICAgICB0aGlzLnNlbGVjdGVkVGVybSA9IHJlcXVlc3RCb2R5LnJlcXVlc3QudGVybVxuICAgICAgICB0aGlzLnVwZGF0ZVRlcm0oKVxuICAgICAgfSlcbiAgICB9XG4gICAgfVxuICBcbiAgXG4gIHVwZGF0ZVRlcm0oKSB7XG4gICAgbGV0IGFzc29jaWF0aW9ucyA9IFtdXG4gICAgbGV0IHRlbXBcbiAgICBsZXQgY291bnRlciA9IDBcbiAgICBsZXQgbG9jYWxJc0V4aXN0ID0gZmFsc2VcbiAgICB0aGlzLmZyYW1lV29ya1NlcnZpY2Uuc2VsZWN0aW9uTGlzdC5mb3JFYWNoKChwYXJlbnQsIGkpID0+IHtcbiAgICAgIGNvdW50ZXIrK1xuICAgICAgdGVtcCA9IHBhcmVudC5jaGlsZHJlbiA/IHBhcmVudC5jaGlsZHJlbi5maWx0ZXIoY2hpbGQgPT4gY2hpbGQuaWRlbnRpZmllciA9PT0gdGhpcy5zZWxlY3RlZFRlcm0uaWRlbnRpZmllcikgOiBudWxsXG4gICAgICBhc3NvY2lhdGlvbnMgPSBwYXJlbnQuY2hpbGRyZW4gPyBwYXJlbnQuY2hpbGRyZW4ubWFwKGMgPT4ge1xuICAgICAgICByZXR1cm4geyBpZGVudGlmaWVyOiBjLmlkZW50aWZpZXJ9IC8vIGFwcHJvdmFsU3RhdHVzOiBjLmFzc29jaWF0aW9uUHJvcGVydGllcz9jLmFzc29jaWF0aW9uUHJvcGVydGllcy5hcHByb3ZhbFN0YXR1czogJ0RyYWZ0J1xuICAgICAgfSkgOiBbXSBcbiAgICAgIGlmKHRlbXAgJiYgdGVtcC5sZW5ndGgpIHtcbiAgICAgICAgdGhpcy5pc1Rlcm1FeGlzdCA9IHRydWVcbiAgICAgICAgcmV0dXJuXG4gICAgICAgIH0gZWxzZSB7IFxuICAgICAgICAgIGFzc29jaWF0aW9ucy5wdXNoKHsgaWRlbnRpZmllcjogdGhpcy5zZWxlY3RlZFRlcm0uaWRlbnRpZmllcn0pIC8vIGFwcHJvdmFsU3RhdHVzOiBhcHBDb25zdGFudHMuRFJBRlQgXG4gICAgICAgICAgdGhpcy5pc1Rlcm1FeGlzdCA9IGZhbHNlXG4gICAgICAgICAgY29uc3QgcmVndWVzdEJvZHkgPSB7XG4gICAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgICAgICB0ZXJtOiB7XG4gICAgICAgICAgICAgICAgYXNzb2NpYXRpb25zOiBbXG4gICAgICAgICAgICAgICAgICAuLi5hc3NvY2lhdGlvbnMgIFxuICAgICAgICAgICAgICAgIF0gICAgXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCcqKioqKioqKioqKioqKioqKioqKioqKioqKionLGFzc29jaWF0aW9ucylcbiAgICAgICAgICAvLyB0aGlzLmRpYWxvZ0Nsb3NlKHsgdGVybTogdGhpcy5zZWxlY3RlZFRlcm0sIGNyZWF0ZWQ6IHRydWUgfSlcbiAgICAgICAgICB0aGlzLmZyYW1lV29ya1NlcnZpY2UudXBkYXRlVGVybSh0aGlzLmRhdGEuZnJhbWV3b3JrSWQsIHBhcmVudC5jYXRlZ29yeSwgcGFyZW50LmNvZGUsIHJlZ3Vlc3RCb2R5KS5zdWJzY3JpYmUoKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICBjb3VudGVyLS07XG4gICAgICAgICAgICBpZihjb3VudGVyID09PSAwICkge1xuICAgICAgICAgICAgICAvLyB0aGlzLnNlbGVjdGVkVGVybVsnYXNzb2NpYXRpb25Qcm9wZXJ0aWVzJ11bJ2FwcHJvdmFsU3RhdHVzJ10gPSAnRHJhZnQnO1xuICAgICAgICAgICAgICB0aGlzLmRpYWxvZ0Nsb3NlKHsgdGVybTogey4uLnRoaXMuc2VsZWN0ZWRUZXJtLCAuLi57YXNzb2NpYXRpb25Qcm9wZXJ0aWVzOnthcHByb3ZhbFN0YXR1czonRHJhZnQnfX19LCBjcmVhdGVkOiB0cnVlIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBkaWFsb2dDbG9zZSh0ZXJtKSB7XG4gICAgICB0aGlzLmZyYW1lV29ya1NlcnZpY2UucHVibGlzaEZyYW1ld29yaygpLnN1YnNjcmliZShyZXMgPT4ge1xuICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSh0ZXJtKTtcbiAgICAgIH0pO1xuICB9XG5cbn1cbiIsIjxkaXYgY2xhc3M9XCJkaWFsb2dcIj5cbiAgICA8ZGl2IGNsYXNzPVwiZGlhbG9nLXRpdGxlXCIgbWF0LWRpYWxvZy10aXRsZT57e2FwcF9zdHJpbmdzLmNyZWF0ZU5ld319IHt7ZGF0YS5jb2x1bW5JbmZvLm5hbWV9fTwvZGl2PlxuICAgIDxmb3JtIFtmb3JtR3JvdXBdPVwiY3JlYXRlVGVybUZvcm1cIiBub3ZhbGlkYXRlIChuZ1N1Ym1pdCk9XCJkaXNhYmxlQ3JlYXRlP3VwZGF0ZVRlcm0oKTpzYXZlVGVybSgpXCI+XG4gICAgICAgIDxtYXQtZm9ybS1maWVsZD5cbiAgICAgICAgICAgIDwhLS0gPG1hdC1sYWJlbD5FbnRlciB7e2RhdGEubmFtZX19IG5hbWU8L21hdC1sYWJlbD4gLS0+XG4gICAgICAgICAgICA8aW5wdXQgbWF0SW5wdXQgZm9ybUNvbnRyb2xOYW1lPVwibmFtZVwiIHBsYWNlaG9sZGVyPVwie3thcHBfc3RyaW5ncy5uYW1lfX1cIiAgIFttYXRBdXRvY29tcGxldGVdPVwiYXV0b1wiPlxuICAgICAgICAgICAgPG1hdC1hdXRvY29tcGxldGUgI2F1dG89XCJtYXRBdXRvY29tcGxldGVcIiAob3B0aW9uU2VsZWN0ZWQpPVwib25TZWxlY3QoJGV2ZW50Lm9wdGlvbilcIj5cbiAgICAgICAgICAgICAgICA8bWF0LW9wdGlvbiAqbmdGb3I9XCJsZXQgb3B0aW9uIG9mIGZpbHRlZFRlcm1MaXN0cyB8IGFzeW5jXCIgIFt2YWx1ZV09XCJvcHRpb25cIj5cbiAgICAgICAgICAgICAgICAgIHt7b3B0aW9uLm5hbWV9fVxuICAgICAgICAgICAgICAgIDwvbWF0LW9wdGlvbj5cbiAgICAgICAgICAgICAgPC9tYXQtYXV0b2NvbXBsZXRlPlxuICAgICAgICA8L21hdC1mb3JtLWZpZWxkPlxuICAgICAgICA8bWF0LWVycm9yICpuZ0lmPVwiaXNUZXJtRXhpc3RcIj57e2FwcF9zdHJpbmdzLmFscmVhZHlFeGlzdH19PC9tYXQtZXJyb3I+XG4gICAgICAgIDxtYXQtZm9ybS1maWVsZD5cbiAgICAgICAgICAgIDwhLS0gPG1hdC1sYWJlbD5FbnRlciB7e2RhdGEubmFtZX19IG5hbWU8L21hdC1sYWJlbD4gLS0+XG4gICAgICAgICAgICA8dGV4dGFyZWEgbWF0SW5wdXQgZm9ybUNvbnRyb2xOYW1lPVwiZGVzY3JpcHRpb25cIiBwbGFjZWhvbGRlcj1cInt7YXBwX3N0cmluZ3MuZGVzY3JpcHRpb259fVwiPjwvdGV4dGFyZWE+XG4gICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XG4gICAgICAgIDxtYXQtZm9ybS1maWVsZD5cbiAgICAgICAgICAgIDwhLS0gPG1hdC1sYWJlbD5FbnRlciB7e2RhdGEuYXJlYX19IGFyZWE8L21hdC1sYWJlbD4gLS0+XG4gICAgICAgICAgICA8aW5wdXQgbWF0SW5wdXQgZm9ybUNvbnRyb2xOYW1lPVwibmFtZVwiIHBsYWNlaG9sZGVyPVwie3thcHBfc3RyaW5ncy5hcmVhfX1cIiAgIFttYXRBdXRvY29tcGxldGVdPVwiYXV0b1wiPlxuICAgICAgICA8L21hdC1mb3JtLWZpZWxkPlxuICAgICAgICA8bWF0LWZvcm0tZmllbGQ+XG4gICAgICAgICAgICA8IS0tIDxtYXQtbGFiZWw+RW50ZXIge3tkYXRhLnR5cGV9fSB0eXBlPC9tYXQtbGFiZWw+IC0tPlxuICAgICAgICAgICAgPGlucHV0IG1hdElucHV0IGZvcm1Db250cm9sTmFtZT1cIm5hbWVcIiBwbGFjZWhvbGRlcj1cInt7YXBwX3N0cmluZ3MubmFtZX19XCIgICBbbWF0QXV0b2NvbXBsZXRlXT1cImF1dG9cIj5cbiAgICAgICAgPC9tYXQtZm9ybS1maWVsZD5cbiAgICAgICAgIDxmb290ZXIgY2xhc3M9XCJhY3Rpb25zXCI+XG4gICAgICAgICAgICA8YnV0dG9uIG1hdC1yYWlzZWQtYnV0dG9uIGNvbG9yPVwiZGVmYXVsdFwiIHR5cGU9XCJyZXNldFwiIChjbGljayk9XCJkaWFsb2dDbG9zZSgnJylcIj57e2FwcF9zdHJpbmdzLmNhbmNlbH19PC9idXR0b24+XG4gICAgICAgICAgICA8YnV0dG9uIG1hdC1yYWlzZWQtYnV0dG9uIGNvbG9yPVwicHJpbWFyeVwiIHR5cGU9XCJzdWJtaXRcIiBjZGtGb2N1c0luaXRpYWwgKm5nSWY9XCIhZGlzYWJsZUNyZWF0ZVwiPnt7YXBwX3N0cmluZ3MuY3JlYXRlfX08L2J1dHRvbj5cbiAgICAgICAgICAgIDxidXR0b24gbWF0LXJhaXNlZC1idXR0b24gY29sb3I9XCJwcmltYXJ5XCIgdHlwZT1cInN1Ym1pdFwiIGNka0ZvY3VzSW5pdGlhbCAqbmdJZj1cImRpc2FibGVDcmVhdGVcIj57e2FwcF9zdHJpbmdzLnVwZGF0ZX19PC9idXR0b24+XG4gICAgICAgIDwvZm9vdGVyPlxuICAgIDwvZm9ybT5cbjwvZGl2PlxuIl19